/*!
 * angular-ui-scroll
 * https://github.com/angular-ui/ui-scroll.git
 * Version: 1.3.2 -- 2015-09-03T15:39:10.862Z
 * License: MIT
 */
!function(){"use strict";angular.module("ui.scroll",[]).directive("uiScrollViewport",function(){return{controller:["$scope","$element",function(a,b){return this.viewport=b,this}]}}).directive("uiScroll",["$log","$injector","$rootScope","$timeout","$q","$parse",function(a,b,c,d,e,f){var g;return b.has&&b.has("$animate")&&(g=b.get("$animate")),{require:["?^uiScrollViewport"],transclude:"element",priority:1e3,terminal:!0,compile:function(h,i,j){return function(h,i,k,l){var m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da,ea,fa,ga,ha,ia;if(R=a.debug||a.log,!(S=k.uiScroll.match(/^\s*(\w+)\s+in\s+([\w\.]+)\s*$/)))throw new Error("Expected uiScroll in form of '_item_ in _datasource_' but got ' + $attr.uiScroll + '");if(P=S[1],B=S[2],A=f(B)(h),N=function(){return angular.isObject(A)&&angular.isFunction(A.get)},!N()&&(A=b.get(B),!N()))throw new Error(B+" is not a valid datasource");return v=Math.max(3,+k.bufferSize||10),u=function(){return fa.outerHeight()*Math.max(.1,+k.padding||.1)},_=function(a){var b;return null!=(b=a[0].scrollHeight)?b:a[0].document.documentElement.scrollHeight},w=null,$=0,H=1,T=1,t=[],U=[],E=!1,r=!1,M=1===angular.version.major&&angular.version.minor<3,Y=g?M?function(a){var b;return t.splice(t.indexOf(a),1),b=e.defer(),g.leave(a.element,function(){return a.scope.$destroy(),b.resolve()}),[b.promise]}:function(a){return t.splice(t.indexOf(a),1),[g.leave(a.element).then(function(){return a.scope.$destroy()})]}:function(a){return t.splice(t.indexOf(a),1),a.element.remove(),a.scope.$destroy(),[]},I=function(a,b){return i.after.apply(b,[a]),[]},J=g?M?function(a,b){var c;return c=e.defer(),g.enter(a,i,b,function(){return c.resolve()}),[c.promise]}:function(a,b){return[g.enter(a,i,b)]}:I,j(h.$new(),function(a,b){var c,d,e,f,g;if(b.$destroy(),e=a[0].localName,"dl"===e)throw new Error("ui-scroll directive does not support <"+a[0].localName+"> as a repeating tag: "+a[0].outerHTML);return"li"!==e&&"tr"!==e&&(e="div"),g=l[0]&&l[0].viewport?l[0].viewport:angular.element(window),g.css({"overflow-y":"auto",display:"block"}),d=function(a){var b,c,d;switch(a){case"tr":d=angular.element("<table><tr><td><div></div></td></tr></table>"),b=d.find("div"),c=d.find("tr"),c.paddingHeight=function(){return b.height.apply(b,arguments)};break;default:c=angular.element("<"+a+"></"+a+">"),c.paddingHeight=c.height}return c},f=d(e),i.before(f),c=d(e),i.after(c),h.$on("$destroy",function(){return a.remove()}),w={viewport:g,topPadding:function(){return f.paddingHeight.apply(f,arguments)},bottomPadding:function(){return c.paddingHeight.apply(c,arguments)},bottomDataPos:function(){return _(g)-c.paddingHeight()},topDataPos:function(){return f.paddingHeight()},insertElement:function(a,b){return I(a,b||f)},insertElementAnimated:function(a,b){return J(a,b||f)}}}),fa=w.viewport,ga=fa.scope()||c,ca=function(a){return m.topVisible=a.scope[P],m.topVisibleElement=a.element,m.topVisibleScope=a.scope,k.topVisible&&f(k.topVisible).assign(ga,m.topVisible),k.topVisibleElement&&f(k.topVisibleElement).assign(ga,m.topVisibleElement),k.topVisibleScope&&f(k.topVisibleScope).assign(ga,m.topVisibleScope),angular.isFunction(A.topVisible)?A.topVisible(a):void 0},Q=function(a){return m.isLoading=a,k.isLoading&&f(k.isLoading).assign(h,a),angular.isFunction(A.loading)?A.loading(a):void 0},X=function(a,b){var c,d,e,f;for(c=d=e=a,f=b;f>=e?f>d:d>f;c=f>=e?++d:--d)t[c].scope.$destroy(),t[c].element.remove();return t.splice(a,b-a)},C=function(){return $++,U=[]},W=function(){return C(),H=1,T=1,X(0,t.length),w.topPadding(0),w.bottomPadding(0),E=!1,r=!1,o($)},s=function(){return fa.scrollTop()+fa.outerHeight()},da=function(){return fa.scrollTop()},aa=function(){return!E&&w.bottomDataPos()<s()+u()},y=function(){var a,b,c,d,e,f,g,h,i,j;for(a=0,h=0,b=f=i=t.length-1;0>=i?0>=f:f>=0;b=0>=i?++f:--f)if(c=t[b],e=c.element.offset().top,g=j!==e,j=e,g&&(d=c.element.outerHeight(!0)),w.bottomDataPos()-a-d>s()+u())g&&(a+=d),h++,E=!1;else{if(g)break;h++}return h>0?(w.bottomPadding(w.bottomPadding()+a),X(t.length-h,t.length),T-=h):void 0},ba=function(){return!r&&w.topDataPos()>da()-u()},z=function(){var a,b,c,d,e,f,g,h,i;for(i=0,g=0,d=0,e=t.length;e>d;d++)if(a=t[d],c=a.element.offset().top,f=h!==c,h=c,f&&(b=a.element.outerHeight(!0)),w.topDataPos()+i+b<da()-u())f&&(i+=b),g++,r=!1;else{if(f)break;g++}return g>0?(w.topPadding(w.topPadding()+i),X(0,g),H+=g):void 0},D=function(a,b){return m.isLoading||Q(!0),1===U.push(b)?G(a):void 0},K=function(a,b){var c,d;if(c=h.$new(),c[P]=b,d={scope:c},j(c,function(a){return d.element=a}),a%1===0)return d.op="insert",t.splice(a,0,d);switch(d.op=a,a){case"append":return t.push(d);case"prepend":return t.unshift(d)}},O=function(a){return a.element.height()&&a.element[0].offsetParent},ha=function(a){var b,c,d;if(O(a)){for(c=0,d=t.length;d>c;c++)b=t[c],angular.isFunction(b.unregisterVisibilityWatcher)&&(b.unregisterVisibilityWatcher(),delete b.unregisterVisibilityWatcher);return o()}},L=function(a,b){return w.insertElement(a.element,b),O(a)?!0:(a.unregisterVisibilityWatcher=a.scope.$watch(function(){return ha(a)}),!1)},V=function(a){var b,c,d,f,g,h,i,j,k,l,m,n,p,q,r,s,u;for(q=[],r=[],s=[],b=w.bottomDataPos(),d=g=0,k=t.length;k>g;d=++g)switch(u=t[d],u.op){case"prepend":r.unshift(u);break;case"append":i=0===d?L(u)||i:L(u,t[d-1].element)||i,u.op="none";break;case"insert":q=0===d?q.concat(w.insertElementAnimated(u.element)):q.concat(w.insertElementAnimated(u.element,t[d-1].element)),u.op="none";break;case"remove":s.push(u)}for(h=0,l=s.length;l>h;h++)u=s[h],q=q.concat(Y(u));if(w.bottomPadding(Math.max(0,w.bottomPadding()-(w.bottomDataPos()-b))),r.length){for(b=w.bottomDataPos(),j=0,m=r.length;m>j;j++)u=r[j],i=L(u)||i,u.op="none";c=w.bottomDataPos()-b,w.topPadding()>=c?w.topPadding(w.topPadding()-c):fa.scrollTop(fa.scrollTop()+c)}for(d=p=0,n=t.length;n>p;d=++p)f=t[d],f.scope.$index=H+d;return q.length&&e.all(q).then(function(){return o(a)}),i},x=function(){var a,b,c,d,e,f,g,h,i;for(i=0,g=[],d=0,e=t.length;e>d;d++){if(a=t[d],c=a.element.offset().top,f=h!==c,h=c,f&&(b=a.element.outerHeight(!0)),!(f&&w.topDataPos()+i+b<da())){f&&ca(a);break}g.push(i+=b)}return g},o=function(a){return d(function(){return V(a),aa()?D(a,!0):ba()&&D(a,!1),0===U.length?x():void 0})},p=function(a){return d(function(){var b;return b=V(a),aa()?b&&D(a,!0):ba()&&(b||U[0])&&D(a,!1),U.shift(),0===U.length?(Q(!1),x()):G(a)})},G=function(a){return U[0]?t.length&&!aa()?p(a):A.get(T,v,function(b){var c,d,e;if(!(a&&a!==$||h.$$destroyed)){if(b.length<v&&(E=!0,w.bottomPadding(0)),b.length>0)for(z(),d=0,e=b.length;e>d;d++)c=b[d],++T,K("append",c);return p(a)}}):t.length&&!ba()?p(a):A.get(H-v,v,function(b){var c,d,e;if(!(a&&a!==$||h.$$destroyed)){if(b.length<v&&(r=!0,w.topPadding(0)),b.length>0)for(t.length&&y(),c=d=e=b.length-1;0>=e?0>=d:d>=0;c=0>=e?++d:--d)--H,K("prepend",b[c]);return p(a)}})},Z=function(){return c.$$phase||m.isLoading?void 0:(o(),h.$apply())},ia=function(a){var b,c;return b=fa[0].scrollTop,c=fa[0].scrollHeight-fa[0].clientHeight,0===b&&!r||b===c&&!E?a.preventDefault():void 0},fa.bind("resize",Z),fa.bind("scroll",Z),fa.bind("mousewheel",ia),h.$watch(A.revision,W),h.$on("$destroy",function(){var a,b,c;for(b=0,c=t.length;c>b;b++)a=t[b],a.scope.$destroy(),a.element.remove();return fa.unbind("resize",Z),fa.unbind("scroll",Z),fa.unbind("mousewheel",ia)}),m={},m.isLoading=!1,m.reload=W,q=function(a,b){var c,d,e,f,g,h,i;if(angular.isArray(b)){for(h=t.indexOf(a)+1,i=b.reverse(),c=d=0,f=i.length;f>d;c=++d)g=i[c],g===a.scope[P]?(e=!0,h--):K(h,g);if(!e)return a.op="remove"}},m.applyUpdates=function(a,b){var c,d,e,f,g,h;if(C(),angular.isFunction(a))for(c=t.slice(0),d=e=0,f=c.length;f>e;d=++e)h=c[d],q(h,a(h.scope[P],h.scope,h.element));else{if(a%1!==0)throw new Error("applyUpdates - "+a+" is not a valid index");0<=(g=a-H)&&g<t.length&&q(t[a-H],b)}return o($)},m.append=function(a){var b,c,d;for(C(),c=0,d=a.length;d>c;c++)b=a[c],++T,K("append",b);return o($)},m.prepend=function(a){var b,c,d,e;for(C(),e=a.reverse(),c=0,d=e.length;d>c;c++)b=e[c],--H,K("prepend",b);return o($)},k.adapter&&(n=f(k.adapter)(h),n||(f(k.adapter).assign(h,{}),n=f(k.adapter)(h)),angular.extend(n,m),m=n),ea=function(a){throw new Error(a+" event is no longer supported - use applyUpdates instead")},F=A.scope?A.scope.$new():h.$new(),F.$on("insert.item",function(){return ea("insert")}),F.$on("update.items",function(){return ea("update")}),F.$on("delete.items",function(){return ea("delete")})}}}}])}();